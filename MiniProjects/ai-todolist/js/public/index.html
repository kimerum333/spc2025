<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #chatbot-area {
            border: 1px solid #ccc;
            padding: 16px;
            margin-top: 8px;
            width: 350px;
            background: #fafbfc;
        }

        #chatbot-history {
            height: 200px;
            overflow-y: auto;
            background: #f4f6fa;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bubble {
            max-width: 75%;
            padding: 8px 12px;
            border-radius: 16px;
            margin-bottom: 2px;
            word-break: break-word;
            font-size: 1rem;
            display: inline-block;
        }

        .bubble.user {
            background: #d1e7ff;
            align-self: flex-end;
            text-align: right;
        }

        .bubble.bot {
            background: #e2e2e2;
            align-self: flex-start;
            text-align: left;
        }

        #chatbot-input-area {
            display: flex;
            gap: 4px;
        }

        #chatbot-input {
            flex: 1;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid #bbb;
            font-size: 1rem;
        }

        #chatbot-send {
            padding: 6px 14px;
            border-radius: 8px;
            border: none;
            background: #007bff;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Ìà¨ÎëêÎ¶¨Ïä§Ìä∏</h1>
    <input type="text" id="newTodo" placeholder="Ìï† Îßê Ï†ÅÍ∏∞">
    <button id="add-todo">Ï∂îÍ∞Ä</button>
    <ul id="todo-list">

    </ul>
    <div id="chatbot-icon" style="cursor:pointer; font-size:2rem;">ü§ñ</div>
    <div id="chatbot-area" style="display:none;">
        <div id="chatbot-history"></div>
        <div id="chatbot-input-area">
            <input id="chatbot-input" type="text" placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." autocomplete="off" />
            <button id="chatbot-send">Ï†ÑÏÜ°</button>
        </div>
    </div>

    <script>
        const todoList = document.getElementById('todo-list');
        const input = document.getElementById('newTodo');
        const addBtn = document.getElementById('add-todo');

        // Ìï† Ïùº Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
        async function fetchTodos() {
            const res = await fetch('/api/todos');
            const todos = await res.json();
            renderTodos(todos);
        }

        // Ìï† Ïùº Ï∂îÍ∞Ä
        addBtn.addEventListener('click', async () => {
            const text = input.value.trim();
            if (!text) return;
            await fetch('/api/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text })
            });
            input.value = '';
            fetchTodos();
        });

        // Ìï† Ïùº Î†åÎçîÎßÅ
        function renderTodos(todos) {
            todoList.innerHTML = '';
            todos.forEach(todo => {
                const li = document.createElement('li');
                li.textContent = todo.text;
                if (todo.completed) li.style.textDecoration = 'line-through';

                // ÌÜ†Í∏Ä Î≤ÑÌäº
                const toggleBtn = document.createElement('button');
                toggleBtn.textContent = todo.completed ? 'Ï∑®ÏÜå' : 'ÏôÑÎ£å';
                toggleBtn.onclick = async () => {
                    await fetch('/api/todos', {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: todo.id })
                    });
                    fetchTodos();
                };

                // ÏÇ≠Ï†ú Î≤ÑÌäº
                const delBtn = document.createElement('button');
                delBtn.textContent = 'ÏÇ≠Ï†ú';
                delBtn.onclick = async () => {
                    await fetch('/api/todos', {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: todo.id })
                    });
                    fetchTodos();
                };

                li.appendChild(toggleBtn);
                li.appendChild(delBtn);
                todoList.appendChild(li);
            });
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ìï† Ïùº Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
        fetchTodos();



        // Ï±óÎ¥á ÌÜ†Í∏Ä
        const chatbotIcon = document.getElementById('chatbot-icon');
        const chatbotArea = document.getElementById('chatbot-area');
        chatbotIcon.addEventListener('click', () => {
            if (chatbotArea.style.display === 'none') {
                chatbotArea.style.display = 'block';
            } else {
                chatbotArea.style.display = 'none';
            }
        });

        // Ï±óÎ¥á Ï±ÑÌåÖ Í∏∞Îä•
        const chatbotHistory = document.getElementById('chatbot-history');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSend = document.getElementById('chatbot-send');

        // Ï±ÑÌåÖ ÌûàÏä§ÌÜ†Î¶¨ Î∞∞Ïó¥
        const chatHistory = [];

        function renderChatHistory() {
            chatbotHistory.innerHTML = '';
            chatHistory.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'bubble ' + (msg.role === 'user' ? 'user' : 'bot');
                div.textContent = msg.text;
                chatbotHistory.appendChild(div);
            });
            chatbotHistory.scrollTop = chatbotHistory.scrollHeight;
        }

        async function sendChat() {
            const text = chatbotInput.value.trim();
            if (!text) return;
            chatHistory.push({ role: 'user', text });
            renderChatHistory();
            chatbotInput.value = '';

            // Ïã§Ï†ú Ï±óÎ¥á ÏùëÎãµ fetch
            try {
                const res = await fetch('/api/chats', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                if (!res.ok) throw new Error('Ï±óÎ¥á ÏÑúÎ≤Ñ Ïò§Î•ò');
                const data = await res.json();
                // ÏùëÎãµÏù¥ Î∞∞Ïó¥ ÌòïÌÉúÎùºÍ≥† Í∞ÄÏ†ï
                if (Array.isArray(data)) {
                    data.forEach(msgObj => {
                        chatHistory.push({ role: 'bot', text: msgObj.message });
                    });
                } else if (data.message) {
                    chatHistory.push({ role: 'bot', text: data.message });
                }
                renderChatHistory();
            } catch (err) {
                chatHistory.push({ role: 'bot', text: 'Ï±óÎ¥á ÏùëÎãµ Ïò§Î•ò: ' + err.message });
                renderChatHistory();
            }
        }

        chatbotSend.addEventListener('click', sendChat);
        chatbotInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') sendChat();
        });
    </script>
    <!-- ...existing code... -->
</body>

</html>